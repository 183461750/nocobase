<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Plugins Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Plugins Document">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="/docs/static/css/docsify-themeable-light.css">
  <link rel="stylesheet" href="/docs/static/css/sidebar.min.css" />
  <link rel="stylesheet" href="/docs/static/css/docsify-plugin-toc.css">
  <link rel="stylesheet" href="/docs/static/css/swagger-ui.css" />
  <style>
    :root {
      --theme-color: #1677ff !important;
      --accent: #1677ff !important;
      --text-color-tertiary: #1677ff !important;
      --bodyFontSize: 14px !important;
      --sidebar-width: 320px;
    }

    .sidebar .folder {
      white-space: nowrap;
    }

    .markdown-section .swagger-ui  tbody tr:nth-child(odd) {
        background: transparent !important;
    }

    .sidebar-nav {
      margin-left: -20px;
    }
  </style>
  <script src="/docs/static/js/swagger-ui-bundle.js" crossorigin></script>
  <script src="/docs/static/js/swagger-ui-standalone-preset.js" crossorigin></script>
</head>

<body>
  <script>
    function loadSwaggerUI(url) {
      document.getElementById('swagger-ui-iframe').remove();
      // console.log('loadSwaggerUI')
      window.ui = SwaggerUIBundle({
        requestInterceptor(req) {
          if (!req.headers['Authorization']) {
            req.headers['Authorization'] = `Bearer ${localStorage.getItem('NOCOBASE_TOKEN')}`;
          }
          return req;
        },
        url: url,
        dom_id: '#swagger-ui',
        presets: [
          SwaggerUIBundle.presets.apis,
        ],
      });
    }
  </script>

  <div id="app"><img src="/docs/static/images/loading.gif"></div>
  <!-- config docsify -->
  <script>
    function removeFrontmatter(content) {
      const regex = /^---\n([\s\S]*?)\n---\n/;
      return content.replace(regex, '');
    }

        // 再 docsify.js 中使用到这个
        window.removeFrontmatter = removeFrontmatter;

      /**
       * get package name by client static url
       *
       * @example
       * getPluginNameByClientStaticUrl('/static/plugins/dayjs/index.js') => 'dayjs'
       * getPluginNameByClientStaticUrl('/static/plugins/@nocobase/foo/README.md') => '@nocobase/foo'
       */
      const PLUGIN_STATICS_PATH = '/static/plugins/'
      function getPackageNameByPathname(pathname) {
        pathname = pathname.replace(PLUGIN_STATICS_PATH, '');
        const pathArr = pathname.split('/');
        if (!pathArr.length) return false;
        if (pathname.startsWith('@')) {
          return pathArr.slice(0, 2).join('/');
        }
        return pathArr[0];
      }
    window.$docsify = {
      coverpage: false,
      subMaxLevel: 0,
      maxLevel: 0,
      loadSidebar: true,
      routerMode: 'hash',
      requestHeaders: {
        'X-Locale': localStorage.getItem('NOCOBASE_LOCALE')
      },
      noEmoji: false,
      auto2top: true,
      autoHeader: false,
      name: 'Plugins Document',
      externalLinkTarget: '_blank',
      loadNavbar: false,
      tabs: {
        persist: false,
        sync: false,
      },
      alias: {
        '/.*/_sidebar.md': '/_sidebar.md',
      },
      toc: {
        tocMaxLevel: 5,
        target: 'h2, h3, h4, h5, h6'
      },
      sidebarDisplayLevel: 0, // set sidebar display level
      // search: 'auto',
      // search: [
      //   '/profiles'            // => /profiles.md
      // ],
      scrollToTop: {
        auto: true,
        text: '⬆',
        right: 15,
        bottom: 15,
        offset: 500,
      },
      'flexible-alerts': {
        style: 'callout',
      },
      plugins: [],
      footer: {
        copy: 'NocoBase © 2022-2023',
        auth: ' ',
        pre: '<hr/>',
        style: 'text-align: right;',
      },
      progress: {
        position: 'top',
        color: 'var(--theme-color,#1677ff)',
        height: '1px',
      },
      markdown: {
        smartypants: true,
        renderer: {
          link: function (href, ...reset) {
            const pathname = window.location.hash.replace('#', '');
            if (!href.startsWith(PLUGIN_STATICS_PATH) && href !== '/') {
              if (href.startsWith('/')) {
                // 绝对路径只需要补全前缀
                const packageName = getPackageNameByPathname(pathname);
                if (packageName) {
                  href = PLUGIN_STATICS_PATH + packageName + href;
                }
              } else {
                // 相对路径需要计算出对应路径的位置
                const aUrl = new URL(pathname, window.origin);
                const bUrl = new URL(href, aUrl);
                href = bUrl.pathname;
              }
            }
            return this.origin.link.apply(this, [href, ...reset]);
          },
          code: function (code, lang) {
            if (lang === "swagger") {
              let queryIndex = window.location.hash.indexOf('?ns=');
              if (queryIndex > -1) {
                code += decodeURIComponent(window.location.hash.slice(queryIndex));
              }
              return (
                '<div id="swagger-ui"></div><iframe id="swagger-ui-iframe" style="display:none;" onload="loadSwaggerUI(\'' + code + '\')" src="/docs"></iframe>'
              );
            }
            return this.origin.code.apply(this, arguments);
          }
        }
      },
      plugins: [
        function (hook, vm) {
          hook.beforeEach(function (content) {
            if (window.location.hash.includes('swagger')) {
              let queryIndex = window.location.hash.indexOf('?q=');
              let url = '/api-documentation';
              if (queryIndex > -1) {
                url += window.location.hash.slice(queryIndex);
              }
              content = content.replace('REPLACE', url);
            }
            return content;
          });
        }
      ]
    };
</script>
  <!-- load docsify v4 -->
  <script src="/docs/static/js/docsify.js"></script>

  <!-- Plug-ins : -->
  <!-- theme -->
  <script src="/docs/static/js/docsify-themeable.min.js"></script>
  <!--footer -->
  <script src="/docs/static/js/docsify-footer-enh.min.js"></script>
  <!-- search -->
  <script src="/docs/static/js/search.min.js"></script>
  <!-- Scrool to top -->
  <script src="/docs/static/js/docsify-scroll-to-top.min.js"></script>
  <!-- zomm image -->
  <script src="/docs/static/js/zoom-image.min.js"></script>
  <script src="/docs/static/js/docsify-plugin-flexible-alerts.min.js"></script>
  <!-- docsify-tabs -->
  <script src="/docs/static/js/docsify-tabs.js"></script>
  <!-- Progress bar -->
  <script src="/docs/static/js/progress.min.js"></script>
  <!-- https://github.com/iPeng6/docsify-sidebar-collapse -->
  <script src="/docs/static/js/docsify-sidebar-collapse.min.js"></script>
  <!-- toc -->
  <script src="/docs/static/js/docsify-plugin-toc.min.js"></script>
</html>
